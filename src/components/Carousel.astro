---
const { discs } = Astro.props;
---

<style>
  main {
    width: 100vw;
    height: 100vh;
    background: var(--background);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    perspective: 1500px;
  }

  .carousel {
    position: relative;
    width: 300px;
    height: 300px;
    transform-style: preserve-3d;
    transition: transform 1s;
    cursor: grab;
  }

  .carousel:active {
    cursor: grabbing;
  }

  .disc {
    position: absolute;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    display: flex;
    justify-content: center;
    align-items: flex-end;
    color: white;
    font-weight: bold;
    font-size: 1rem;
    padding: 0.5rem;
    text-shadow: 0 0 5px black;
    user-select: none;
    text-align: center;
  }
</style>

<script>
  const carousel = document.querySelector('.carousel');
  const discsEls = [...document.querySelectorAll('.disc')];
  let angle = 0;
  let startX;
  let currentX;
  let isDragging = false;

  function rotateCarousel() {
    carousel.style.transform = `translateZ(-300px) rotateY(${angle}deg)`;
  }

  function positionDiscs() {
    const n = discsEls.length;
    discsEls.forEach((disc, i) => {
      const discAngle = (360 / n) * i;
      disc.style.transform = `rotateY(${discAngle}deg) translateZ(300px)`;
    });
  }

  positionDiscs();
  rotateCarousel();

  carousel.addEventListener('pointerdown', e => {
    isDragging = true;
    startX = e.clientX;
  });

  carousel.addEventListener('pointermove', e => {
    if (!isDragging) return;
    currentX = e.clientX;
    const deltaX = currentX - startX;
    angle += deltaX * 0.5;
    rotateCarousel();
    startX = currentX;
  });

  carousel.addEventListener('pointerup', () => {
    isDragging = false;
  });

  carousel.addEventListener('pointerleave', () => {
    isDragging = false;
  });
</script>

<div class="carousel">
  {discs.map(disc => (
    <a
      href={disc.link}
      class="disc"
      style={`background-image: url('${disc.image}')`}
    >
      <span>{disc.title}</span>
    </a>
  ))}
</div>
