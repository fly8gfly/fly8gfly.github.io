---
const discs = [
  { image: '/discs/Home.jpg', title: 'Home', link: '/home' },
  { image: '/discs/youtube.jpg', title: 'YouTube Channels', link: '/youtube-channels' },
  { image: '/discs/Products.jpg', title: 'Products', link: '/products' },
  { image: '/discs/flying-tips.jpg', title: 'Flying Tips', link: '/flying-tips' },
];
---

<style>
  main {
    width: 100vw;
    height: 100vh;
    background: var(--background, #111);
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    perspective: 2000px;
  }

  .carousel {
    position: relative;
    width: 80vw;
    height: 80vw;
    transform-style: preserve-3d;
    transition: transform 1s ease;
    cursor: grab;
  }

  .carousel:active {
    cursor: grabbing;
  }

  .disc {
    position: absolute;
    width: 30vw;
    height: 30vw;
    border-radius: 50%;
    background-size: cover;
    background-position: center;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    display: flex;
    justify-content: center;
    align-items: flex-end;
    color: white;
    font-weight: bold;
    font-size: 1rem;
    padding: 0.5rem;
    text-shadow: 0 0 5px black;
    user-select: none;
    text-align: center;
    transform-origin: center center;
    transition: transform 0.5s ease, translateZ 0.5s ease;
  }

  .disc.focused {
    transform: translateZ(120px) rotateY(0deg) scale(1.1);
    z-index: 10;
  }
</style>

<div class="carousel">
  {discs.map((disc) => (
    <a
      href={disc.link}
      class="disc"
      style={`background-image: url('${disc.image}')`}
    >
      <span>{disc.title}</span>
    </a>
  ))}
</div>

<script is:inline>
  const carousel = document.querySelector('.carousel');
  const discsEls = [...document.querySelectorAll('.disc')];
  let angle = 0;
  let startX;
  let currentX;
  let isDragging = false;
  const radius = 40;

  function rotateCarousel() {
    carousel.style.transform = `rotateY(${angle}deg)`;
    updateFocus();
  }

  function positionDiscs() {
    const n = discsEls.length;
    discsEls.forEach((disc, i) => {
      const discAngle = (360 / n) * i;
      disc.style.transform = `rotateY(${discAngle}deg) translateZ(${radius}vw)`;
    });
  }

  function updateFocus() {
    let closestIndex = 0;
    let minDiff = 9999;
    const n = discsEls.length;

    discsEls.forEach((disc, i) => {
      const discAngle = ((360 / n) * i + angle) % 360;
      const diff = Math.min(Math.abs(discAngle), 360 - Math.abs(discAngle));
      if (diff < minDiff) {
        minDiff = diff;
        closestIndex = i;
      }
      disc.classList.remove('focused');
    });

    discsEls[closestIndex].classList.add('focused');
  }

  positionDiscs();
  rotateCarousel();

  carousel.addEventListener('pointerdown', (e) => {
    isDragging = true;
    startX = e.clientX;
  });

  carousel.addEventListener('pointermove', (e) => {
    if (!isDragging) return;
    currentX = e.clientX;
    const deltaX = currentX - startX;
    angle += deltaX * 0.5;
    rotateCarousel();
    startX = currentX;
  });

  carousel.addEventListener('pointerup', () => {
    isDragging = false;
  });

  carousel.addEventListener('pointerleave', () => {
    isDragging = false;
  });
</script>
